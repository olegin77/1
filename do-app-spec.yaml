name: weddingtech
features:
  - buildpack-stack=ubuntu-22
ingress:
  rules:
    - component: { name: backend }
      match: { path: { prefix: /api } }
    - component: { name: frontend }
      match: { path: { prefix: / } }
services:
  - name: frontend
    environment_slug: node-js
    github: { repo: olegin77/weddingtech, branch: main, deploy_on_push: true }
    source_dir: frontend
    build_command: "npm ci && npm run build"
    run_command: "next start -p $PORT --hostname 0.0.0.0"
    http_port: 8080
    instance_count: 1
    instance_size_slug: basic-xxs
    envs:
      - { key: NODE_ENV, value: "production" }
      - { key: NODE_VERSION, value: "20" }
      - { key: NEXT_TELEMETRY_DISABLED, value: "1" }
      - { key: NEXT_PUBLIC_API_BASE, value: "/api" }
      - { key: NPM_CONFIG_PRODUCTION, value: "false", scope: "BUILD_TIME" }
    health_check:
      http_path: "/health"
      initial_delay_seconds: 10
      period_seconds: 10
      timeout_seconds: 5
      success_threshold: 1
      failure_threshold: 3
  - name: backend
    environment_slug: node-js
    github: { repo: olegin77/weddingtech, branch: main, deploy_on_push: true }
    source_dir: backend
    build_command: "npm ci"
    run_command: "npm run start"
    http_port: 8080
    instance_count: 1
    instance_size_slug: basic-xxs
    envs:
      - { key: NODE_ENV, value: "production" }
      - { key: NODE_VERSION, value: "20" }
    health_check:
      http_path: "/health"
      initial_delay_seconds: 5
      period_seconds: 10
      timeout_seconds: 5
      success_threshold: 1
      failure_threshold: 3
